<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTC Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .sidebar {
            transition: width 0.3s ease;
        }
        .kpi-card {
            transition: all 0.3s ease;
            border-left-width: 4px;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .nav-item.active {
            background-color: #e6f7ff;
            color: #1890ff;
            font-weight: 600;
        }
        .nav-item.active i {
            color: #1890ff;
        }
        .nav-item {
            cursor: pointer;
        }
    </style>
</head>
<body class="flex bg-gray-100">

    <!-- Sidebar -->
    <aside class="sidebar w-64 bg-white p-6 shadow-lg flex-shrink-0">
        <div class="flex items-center mb-10">
            <div class="bg-blue-600 p-2 rounded-lg">
                <i class="fas fa-chart-pie text-white text-xl"></i>
            </div>
            <h1 class="text-xl font-bold ml-3 text-gray-800">Analytics</h1>
        </div>
        <nav>
            <ul>
                <li class="mb-4">
                    <a onclick="showPage('summary')" class="nav-item flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-50 active">
                        <i class="fas fa-tachometer-alt w-6 text-center"></i>
                        <span class="ml-4">Executive Summary</span>
                    </a>
                </li>
                <li class="mb-4">
                    <a onclick="showPage('efficiency')" class="nav-item flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <i class="fas fa-bullseye w-6 text-center"></i>
                        <span class="ml-4">Channel Efficiency</span>
                    </a>
                </li>
                <li class="mb-4">
                    <a onclick="showPage('profitability')" class="nav-item flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <i class="fas fa-dollar-sign w-6 text-center"></i>
                        <span class="ml-4">Profitability</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="absolute bottom-5">
            <p class="text-xs text-gray-400">DTC Analytics Project v1.0</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h2 id="page-title" class="text-3xl font-bold text-gray-800">Executive Summary</h2>
                <p id="page-subtitle" class="text-gray-500">A high-level overview of business performance.</p>
            </div>
            <div class="flex items-center space-x-4">
                 <div class="relative">
                    <label for="year-selector" class="sr-only">Select Year</label>
                    <select id="year-selector" class="pl-4 pr-10 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option>2024</option>
                        <option>2023</option>
                    </select>
                     <i class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                </div>
            </div>
        </header>

        <!-- Page Content: Executive Summary -->
        <div id="summary-page" class="page-content">
            <div id="summary-kpis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- KPI cards will be injected here -->
            </div>
            <div class="chart-container">
                <canvas id="revenueSpendChart"></canvas>
            </div>
        </div>
        
        <!-- Page Content: Channel Efficiency -->
        <div id="efficiency-page" class="page-content hidden">
            <div class="chart-container">
                 <canvas id="efficiencyBubbleChart"></canvas>
            </div>
             <div class="mt-8 chart-container">
                 <h3 class="text-xl font-semibold mb-4 text-gray-700">2024 Channel KPI Data</h3>
                 <div id="kpi-table-container"></div>
            </div>
        </div>

        <!-- Page Content: Profitability -->
        <div id="profitability-page" class="page-content hidden">
             <div id="profit-kpis" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Profit KPI cards will be injected here -->
            </div>
            <div class="chart-container">
                 <canvas id="profitabilityChart"></canvas>
            </div>
        </div>

    </main>

    <script>
        // --- EMBEDDED DATA ---
        // The preprocessed data from 'monthly_summary_v5_final_non_redundant.csv' is embedded here.
        const masterData = [
            {"YEAR":2023,"MONTH":"JANUARY","CHANNEL":"Affiliates","Sessions":15000.0,"Clicks":3000.0,"Spend":0.0,"Total_Returns":25432.21,"Technology_Spend":15000.0,"Total_Revenue":968195.0,"Orders_Existing":120.0,"Customers_Existing":114.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JANUARY","CHANNEL":"Paid Search","Sessions":95000.0,"Clicks":19000.0,"Spend":0.0,"Total_Returns":25432.21,"Technology_Spend":15000.0,"Total_Revenue":968195.0,"Orders_Existing":765.0,"Customers_Existing":734.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JANUARY","CHANNEL":"Paid Social","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":25432.21,"Technology_Spend":15000.0,"Total_Revenue":968195.0,"Orders_Existing":124.0,"Customers_Existing":118.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"FEBRUARY","CHANNEL":"Affiliates","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":21987.43,"Technology_Spend":15000.0,"Total_Revenue":784298.0,"Orders_Existing":128.0,"Customers_Existing":122.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"FEBRUARY","CHANNEL":"Paid Search","Sessions":70000.0,"Clicks":14000.0,"Spend":0.0,"Total_Returns":21987.43,"Technology_Spend":15000.0,"Total_Revenue":784298.0,"Orders_Existing":550.0,"Customers_Existing":524.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"FEBRUARY","CHANNEL":"Paid Social","Sessions":15000.0,"Clicks":3000.0,"Spend":0.0,"Total_Returns":21987.43,"Technology_Spend":15000.0,"Total_Revenue":784298.0,"Orders_Existing":106.0,"Customers_Existing":101.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MARCH","CHANNEL":"Affiliates","Sessions":17000.0,"Clicks":3400.0,"Spend":0.0,"Total_Returns":28711.23,"Technology_Spend":15000.0,"Total_Revenue":1118958.0,"Orders_Existing":138.0,"Customers_Existing":132.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MARCH","CHANNEL":"Paid Search","Sessions":45000.0,"Clicks":9000.0,"Spend":0.0,"Total_Returns":28711.23,"Technology_Spend":15000.0,"Total_Revenue":1118958.0,"Orders_Existing":274.0,"Customers_Existing":259.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MARCH","CHANNEL":"Paid Social","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":28711.23,"Technology_Spend":15000.0,"Total_Revenue":1118958.0,"Orders_Existing":104.0,"Customers_Existing":99.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"APRIL","CHANNEL":"Affiliates","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":21874.92,"Technology_Spend":15000.0,"Total_Revenue":892836.0,"Orders_Existing":144.0,"Customers_Existing":137.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"APRIL","CHANNEL":"Paid Search","Sessions":50000.0,"Clicks":10000.0,"Spend":0.0,"Total_Returns":21874.92,"Technology_Spend":15000.0,"Total_Revenue":892836.0,"Orders_Existing":319.0,"Customers_Existing":302.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"APRIL","CHANNEL":"Paid Social","Sessions":14000.0,"Clicks":2800.0,"Spend":0.0,"Total_Returns":21874.92,"Technology_Spend":15000.0,"Total_Revenue":892836.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MAY","CHANNEL":"Affiliates","Sessions":17500.0,"Clicks":3500.0,"Spend":0.0,"Total_Returns":46321.87,"Technology_Spend":15000.0,"Total_Revenue":1702721.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MAY","CHANNEL":"Paid Search","Sessions":120000.0,"Clicks":24000.0,"Spend":0.0,"Total_Returns":46321.87,"Technology_Spend":15000.0,"Total_Revenue":1702721.0,"Orders_Existing":1084.0,"Customers_Existing":1036.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"MAY","CHANNEL":"Paid Social","Sessions":15500.0,"Clicks":3100.0,"Spend":0.0,"Total_Returns":46321.87,"Technology_Spend":15000.0,"Total_Revenue":1702721.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JUNE","CHANNEL":"Affiliates","Sessions":17000.0,"Clicks":3400.0,"Spend":0.0,"Total_Returns":21234.54,"Technology_Spend":15000.0,"Total_Revenue":864458.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JUNE","CHANNEL":"Paid Search","Sessions":90000.0,"Clicks":18000.0,"Spend":0.0,"Total_Returns":21234.54,"Technology_Spend":15000.0,"Total_Revenue":864458.0,"Orders_Existing":774.0,"Customers_Existing":735.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JUNE","CHANNEL":"Paid Social","Sessions":14500.0,"Clicks":2900.0,"Spend":0.0,"Total_Returns":21234.54,"Technology_Spend":15000.0,"Total_Revenue":864458.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JULY","CHANNEL":"Affiliates","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":28765.98,"Technology_Spend":15000.0,"Total_Revenue":1036750.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JULY","CHANNEL":"Paid Search","Sessions":110000.0,"Clicks":22000.0,"Spend":0.0,"Total_Returns":28765.98,"Technology_Spend":15000.0,"Total_Revenue":1036750.0,"Orders_Existing":937.0,"Customers_Existing":891.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"JULY","CHANNEL":"Paid Social","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":28765.98,"Technology_Spend":15000.0,"Total_Revenue":1036750.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"AUGUST","CHANNEL":"Affiliates","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":24387.65,"Technology_Spend":15000.0,"Total_Revenue":991799.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"AUGUST","CHANNEL":"Paid Search","Sessions":125000.0,"Clicks":25000.0,"Spend":0.0,"Total_Returns":24387.65,"Technology_Spend":15000.0,"Total_Revenue":991799.0,"Orders_Existing":1079.0,"Customers_Existing":1024.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"AUGUST","CHANNEL":"Paid Social","Sessions":16500.0,"Clicks":3300.0,"Spend":0.0,"Total_Returns":24387.65,"Technology_Spend":15000.0,"Total_Revenue":991799.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"SEPTEMBER","CHANNEL":"Affiliates","Sessions":19000.0,"Clicks":3800.0,"Spend":0.0,"Total_Returns":31245.76,"Technology_Spend":15000.0,"Total_Revenue":1182469.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"SEPTEMBER","CHANNEL":"Paid Search","Sessions":130000.0,"Clicks":26000.0,"Spend":0.0,"Total_Returns":31245.76,"Technology_Spend":15000.0,"Total_Revenue":1182469.0,"Orders_Existing":1050.0,"Customers_Existing":996.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"SEPTEMBER","CHANNEL":"Paid Social","Sessions":17000.0,"Clicks":3400.0,"Spend":0.0,"Total_Returns":31245.76,"Technology_Spend":15000.0,"Total_Revenue":1182469.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"OCTOBER","CHANNEL":"Affiliates","Sessions":18500.0,"Clicks":3700.0,"Spend":0.0,"Total_Returns":22876.54,"Technology_Spend":15000.0,"Total_Revenue":917970.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"OCTOBER","CHANNEL":"Paid Search","Sessions":100000.0,"Clicks":20000.0,"Spend":0.0,"Total_Returns":22876.54,"Technology_Spend":15000.0,"Total_Revenue":917970.0,"Orders_Existing":779.0,"Customers_Existing":739.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"OCTOBER","CHANNEL":"Paid Social","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":22876.54,"Technology_Spend":15000.0,"Total_Revenue":917970.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"NOVEMBER","CHANNEL":"Affiliates","Sessions":20000.0,"Clicks":4000.0,"Spend":0.0,"Total_Returns":71234.87,"Technology_Spend":15000.0,"Total_Revenue":2544000.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"NOVEMBER","CHANNEL":"Paid Search","Sessions":280000.0,"Clicks":56000.0,"Spend":0.0,"Total_Returns":71234.87,"Technology_Spend":15000.0,"Total_Revenue":2544000.0,"Orders_Existing":2518.0,"Customers_Existing":2393.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"NOVEMBER","CHANNEL":"Paid Social","Sessions":25000.0,"Clicks":5000.0,"Spend":0.0,"Total_Returns":71234.87,"Technology_Spend":15000.0,"Total_Revenue":2544000.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"DECEMBER","CHANNEL":"Affiliates","Sessions":22000.0,"Clicks":4400.0,"Spend":0.0,"Total_Returns":43218.98,"Technology_Spend":15000.0,"Total_Revenue":1595092.0,"Orders_Existing":138.0,"Customers_Existing":131.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"DECEMBER","CHANNEL":"Paid Search","Sessions":200000.0,"Clicks":40000.0,"Spend":0.0,"Total_Returns":43218.98,"Technology_Spend":15000.0,"Total_Revenue":1595092.0,"Orders_Existing":1734.0,"Customers_Existing":1647.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2023,"MONTH":"DECEMBER","CHANNEL":"Paid Social","Sessions":28000.0,"Clicks":5600.0,"Spend":0.0,"Total_Returns":43218.98,"Technology_Spend":15000.0,"Total_Revenue":1595092.0,"Orders_Existing":100.0,"Customers_Existing":95.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2024,"MONTH":"JANUARY","CHANNEL":"Affiliates","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":25432.21,"Technology_Spend":0.0,"Total_Revenue":957701.42,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":130.0,"Customers_New":129.0},
            {"YEAR":2024,"MONTH":"JANUARY","CHANNEL":"Paid Search","Sessions":115000.0,"Clicks":23000.0,"Spend":33131.2,"Total_Returns":25432.21,"Technology_Spend":0.0,"Total_Revenue":957701.42,"Orders_Existing":1041.0,"Customers_Existing":1010.0,"Orders_New":1398.0,"Customers_New":1380.0},
            {"YEAR":2024,"MONTH":"JANUARY","CHANNEL":"Paid Social","Sessions":20000.0,"Clicks":4000.0,"Spend":0.0,"Total_Returns":25432.21,"Technology_Spend":0.0,"Total_Revenue":957701.42,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":108.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"FEBRUARY","CHANNEL":"Affiliates","Sessions":15000.0,"Clicks":3000.0,"Spend":0.0,"Total_Returns":21987.43,"Technology_Spend":0.0,"Total_Revenue":954880.12,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":116.0,"Customers_New":119.0},
            {"YEAR":2024,"MONTH":"FEBRUARY","CHANNEL":"Paid Search","Sessions":110000.0,"Clicks":22000.0,"Spend":31642.31,"Total_Returns":21987.43,"Technology_Spend":0.0,"Total_Revenue":954880.12,"Orders_Existing":968.0,"Customers_Existing":932.0,"Orders_New":1068.0,"Customers_New":1085.0},
            {"YEAR":2024,"MONTH":"FEBRUARY","CHANNEL":"Paid Social","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":21987.43,"Technology_Spend":0.0,"Total_Revenue":954880.12,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":110.0,"Customers_New":112.0},
            {"YEAR":2024,"MONTH":"MARCH","CHANNEL":"Affiliates","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":28711.23,"Technology_Spend":0.0,"Total_Revenue":975023.84,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":111.0},
            {"YEAR":2024,"MONTH":"MARCH","CHANNEL":"Paid Search","Sessions":112000.0,"Clicks":22400.0,"Spend":31725.23,"Total_Returns":28711.23,"Technology_Spend":0.0,"Total_Revenue":975023.84,"Orders_Existing":978.0,"Customers_Existing":935.0,"Orders_New":963.0,"Customers_New":955.0},
            {"YEAR":2024,"MONTH":"MARCH","CHANNEL":"Paid Social","Sessions":19000.0,"Clicks":3800.0,"Spend":0.0,"Total_Returns":28711.23,"Technology_Spend":0.0,"Total_Revenue":975023.84,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":106.0,"Customers_New":109.0},
            {"YEAR":2024,"MONTH":"APRIL","CHANNEL":"Affiliates","Sessions":17000.0,"Clicks":3400.0,"Spend":0.0,"Total_Returns":21874.92,"Technology_Spend":0.0,"Total_Revenue":1090895.52,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":111.0},
            {"YEAR":2024,"MONTH":"APRIL","CHANNEL":"Paid Search","Sessions":120000.0,"Clicks":24000.0,"Spend":32933.83,"Total_Returns":21874.92,"Technology_Spend":0.0,"Total_Revenue":1090895.52,"Orders_Existing":1101.0,"Customers_Existing":1060.0,"Orders_New":1168.0,"Customers_New":1162.0},
            {"YEAR":2024,"MONTH":"APRIL","CHANNEL":"Paid Social","Sessions":20000.0,"Clicks":4000.0,"Spend":0.0,"Total_Returns":21874.92,"Technology_Spend":0.0,"Total_Revenue":1090895.52,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":103.0,"Customers_New":105.0},
            {"YEAR":2024,"MONTH":"MAY","CHANNEL":"Affiliates","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":46321.87,"Technology_Spend":0.0,"Total_Revenue":1516157.7,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"MAY","CHANNEL":"Paid Search","Sessions":130000.0,"Clicks":26000.0,"Spend":48251.61,"Total_Returns":46321.87,"Technology_Spend":0.0,"Total_Revenue":1516157.7,"Orders_Existing":1276.0,"Customers_Existing":1232.0,"Orders_New":1409.0,"Customers_New":1399.0},
            {"YEAR":2024,"MONTH":"MAY","CHANNEL":"Paid Social","Sessions":22000.0,"Clicks":4400.0,"Spend":0.0,"Total_Returns":46321.87,"Technology_Spend":0.0,"Total_Revenue":1516157.7,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"JUNE","CHANNEL":"Affiliates","Sessions":16000.0,"Clicks":3200.0,"Spend":0.0,"Total_Returns":21234.54,"Technology_Spend":0.0,"Total_Revenue":1011701.99,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"JUNE","CHANNEL":"Paid Search","Sessions":105000.0,"Clicks":21000.0,"Spend":41934.92,"Total_Returns":21234.54,"Technology_Spend":0.0,"Total_Revenue":1011701.99,"Orders_Existing":942.0,"Customers_Existing":916.0,"Orders_New":939.0,"Customers_New":933.0},
            {"YEAR":2024,"MONTH":"JUNE","CHANNEL":"Paid Social","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":21234.54,"Technology_Spend":0.0,"Total_Revenue":1011701.99,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"JULY","CHANNEL":"Affiliates","Sessions":17000.0,"Clicks":3400.0,"Spend":0.0,"Total_Returns":28765.98,"Technology_Spend":0.0,"Total_Revenue":948311.9,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"JULY","CHANNEL":"Paid Search","Sessions":110000.0,"Clicks":22000.0,"Spend":56408.21,"Total_Returns":28765.98,"Technology_Spend":0.0,"Total_Revenue":948311.9,"Orders_Existing":951.0,"Customers_Existing":901.0,"Orders_New":1019.0,"Customers_New":1011.0},
            {"YEAR":2024,"MONTH":"JULY","CHANNEL":"Paid Social","Sessions":19000.0,"Clicks":3800.0,"Spend":0.0,"Total_Returns":28765.98,"Technology_Spend":0.0,"Total_Revenue":948311.9,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"AUGUST","CHANNEL":"Affiliates","Sessions":18000.0,"Clicks":3600.0,"Spend":0.0,"Total_Returns":24387.65,"Technology_Spend":0.0,"Total_Revenue":1128109.82,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"AUGUST","CHANNEL":"Paid Search","Sessions":125000.0,"Clicks":25000.0,"Spend":65506.0,"Total_Returns":24387.65,"Technology_Spend":0.0,"Total_Revenue":1128109.82,"Orders_Existing":1215.0,"Customers_Existing":1173.0,"Orders_New":1315.0,"Customers_New":1308.0},
            {"YEAR":2024,"MONTH":"AUGUST","CHANNEL":"Paid Social","Sessions":21000.0,"Clicks":4200.0,"Spend":0.0,"Total_Returns":24387.65,"Technology_Spend":0.0,"Total_Revenue":1128109.82,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"SEPTEMBER","CHANNEL":"Affiliates","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":31245.76,"Technology_Spend":0.0,"Total_Revenue":958710.51,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"SEPTEMBER","CHANNEL":"Paid Search","Sessions":130000.0,"Clicks":26000.0,"Spend":51646.0,"Total_Returns":31245.76,"Technology_Spend":0.0,"Total_Revenue":958710.51,"Orders_Existing":0.0,"Customers_Existing":1083.0,"Orders_New":0.0,"Customers_New":1307.0},
            {"YEAR":2024,"MONTH":"SEPTEMBER","CHANNEL":"Paid Social","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":31245.76,"Technology_Spend":0.0,"Total_Revenue":958710.51,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"OCTOBER","CHANNEL":"Affiliates","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":22876.54,"Technology_Spend":0.0,"Total_Revenue":985807.41,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"OCTOBER","CHANNEL":"Paid Search","Sessions":140000.0,"Clicks":28000.0,"Spend":68150.0,"Total_Returns":22876.54,"Technology_Spend":0.0,"Total_Revenue":985807.41,"Orders_Existing":0.0,"Customers_Existing":1095.0,"Orders_New":0.0,"Customers_New":1224.0},
            {"YEAR":2024,"MONTH":"OCTOBER","CHANNEL":"Paid Social","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":22876.54,"Technology_Spend":0.0,"Total_Revenue":985807.41,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"NOVEMBER","CHANNEL":"Affiliates","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":71234.87,"Technology_Spend":0.0,"Total_Revenue":1764492.45,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"NOVEMBER","CHANNEL":"Paid Search","Sessions":200000.0,"Clicks":40000.0,"Spend":88112.0,"Total_Returns":71234.87,"Technology_Spend":0.0,"Total_Revenue":1764492.45,"Orders_Existing":0.0,"Customers_Existing":1986.0,"Orders_New":0.0,"Customers_New":1969.0},
            {"YEAR":2024,"MONTH":"NOVEMBER","CHANNEL":"Paid Social","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":71234.87,"Technology_Spend":0.0,"Total_Revenue":1764492.45,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2024,"MONTH":"DECEMBER","CHANNEL":"Affiliates","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":43218.98,"Technology_Spend":0.0,"Total_Revenue":2345488.27,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":112.0,"Customers_New":110.0},
            {"YEAR":2024,"MONTH":"DECEMBER","CHANNEL":"Paid Search","Sessions":220000.0,"Clicks":44000.0,"Spend":92682.0,"Total_Returns":43218.98,"Technology_Spend":0.0,"Total_Revenue":2345488.27,"Orders_Existing":0.0,"Customers_Existing":2220.0,"Orders_New":0.0,"Customers_New":2688.0},
            {"YEAR":2024,"MONTH":"DECEMBER","CHANNEL":"Paid Social","Sessions":0.0,"Clicks":0.0,"Spend":0.0,"Total_Returns":43218.98,"Technology_Spend":0.0,"Total_Revenue":2345488.27,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":102.0,"Customers_New":103.0},
            {"YEAR":2025,"MONTH":"JANUARY","CHANNEL":"Paid Search","Sessions":0.0,"Clicks":0.0,"Spend":52392.0,"Total_Returns":0.0,"Technology_Spend":0.0,"Total_Revenue":1079835.87,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2025,"MONTH":"FEBRUARY","CHANNEL":"Paid Search","Sessions":0.0,"Clicks":0.0,"Spend":53764.0,"Total_Returns":0.0,"Technology_Spend":0.0,"Total_Revenue":876298.03,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2025,"MONTH":"MARCH","CHANNEL":"Paid Search","Sessions":0.0,"Clicks":0.0,"Spend":76624.0,"Total_Returns":0.0,"Technology_Spend":0.0,"Total_Revenue":1159321.11,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2025,"MONTH":"APRIL","CHANNEL":"Paid Search","Sessions":0.0,"Clicks":0.0,"Spend":80616.0,"Total_Returns":0.0,"Technology_Spend":0.0,"Total_Revenue":1214502.58,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":0.0,"Customers_New":0.0},
            {"YEAR":2025,"MONTH":"MAY","CHANNEL":"Paid Search","Sessions":0.0,"Clicks":0.0,"Spend":79749.0,"Total_Returns":0.0,"Technology_Spend":0.0,"Total_Revenue":1618042.01,"Orders_Existing":0.0,"Customers_Existing":0.0,"Orders_New":0.0,"Customers_New":0.0}
        ];
    
        const df = pd.DataFrame(masterData); // This is a placeholder for how you might use pandas in a JS context
                                             // In reality, all logic below will be pure JS
    
        // --- DATA PROCESSING AND CHARTING LOGIC (JavaScript) ---
        const monthMap = { 'JANUARY': 1, 'FEBRUARY': 2, 'MARCH': 3, 'APRIL': 4, 'MAY': 5, 'JUNE': 6, 'JULY': 7, 'AUGUST': 8, 'SEPTEMBER': 9, 'OCTOBER': 10, 'NOVEMBER': 11, 'DECEMBER': 12 };
        
        masterData.forEach(d => {
            d.Total_Orders = d.Orders_New + d.Orders_Existing;
            d.Total_Customers = d.Customers_New + d.Customers_Existing;
            d.Date = new Date(d.YEAR, monthMap[d.MONTH] - 1, 1);
        });

        const yearSelector = document.getElementById('year-selector');
        const kpiContainer = document.getElementById('summary-kpis');
        const profitKpiContainer = document.getElementById('profit-kpis');
        const pageTitle = document.getElementById('page-title');
        const pageSubtitle = document.getElementById('page-subtitle');

        let revSpendChart, efficiencyBubbleChart, profitabilityChart;

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('en-US').format(value);
        }

        function updateDashboard() {
            const selectedYear = parseInt(yearSelector.value);
            const yearData = masterData.filter(d => d.YEAR === selectedYear);
            
            // --- Update KPIs ---
            const monthlyRevenue = [...new Map(yearData.map(d => [d.MONTH, {rev: d.Total_Revenue, ret: d.Total_Returns, tech: d.Technology_Spend}])).values()];
            const totalRevenue = monthlyRevenue.reduce((sum, item) => sum + item.rev, 0);
            const totalSpend = yearData.reduce((sum, item) => sum + item.Spend, 0);
            const totalCustomers = yearData.reduce((sum, item) => sum + item.Total_Customers, 0);
            const totalReturns = monthlyRevenue.reduce((sum, item) => sum + item.ret, 0);
            const totalTechSpend = monthlyRevenue.reduce((sum, item) => sum + item.tech, 0);

            const blendedCAC = totalCustomers > 0 ? totalSpend / totalCustomers : 0;
            const blendedROAS = totalSpend > 0 ? totalRevenue / totalSpend : Infinity;
            const netRevenue = totalRevenue - totalReturns;
            const contributionMargin = netRevenue - totalSpend;
            const avgMER = totalSpend > 0 ? totalRevenue / totalSpend : 0;
            
            const summaryKpis = [
                { label: 'Total Revenue', value: formatCurrency(totalRevenue), icon: 'fa-dollar-sign', color: 'border-blue-500' },
                { label: 'Total Media Spend', value: formatCurrency(totalSpend), icon: 'fa-money-bill-wave', color: 'border-red-500' },
                { label: 'Overall Blended ROAS', value: isFinite(blendedROAS) ? `${blendedROAS.toFixed(2)}x` : 'N/A', icon: 'fa-arrow-trend-up', color: 'border-green-500' },
                { label: 'Overall Blended CAC', value: formatCurrency(blendedCAC), icon: 'fa-user-tag', color: 'border-yellow-500' },
            ];
            
            const profitKpis = [
                 { label: 'Total Net Revenue', value: formatCurrency(netRevenue), icon: 'fa-sack-dollar', color: 'border-green-500' },
                 { label: 'Avg. Marketing Efficiency', value: `${avgMER.toFixed(2)}x`, icon: 'fa-chart-line', color: 'border-blue-500' },
                 { label: 'Contribution Margin', value: formatCurrency(contributionMargin), icon: 'fa-coins', color: 'border-yellow-500' },
            ];

            kpiContainer.innerHTML = summaryKpis.map(kpi => `
                <div class="kpi-card bg-white p-6 rounded-xl shadow-sm ${kpi.color}">
                    <div class="flex items-center">
                        <div class="p-3 bg-gray-100 rounded-full mr-4"><i class="${kpi.icon} text-xl text-gray-600"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">${kpi.label}</p>
                            <p class="text-3xl font-bold text-gray-800">${kpi.value}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            profitKpiContainer.innerHTML = profitKpis.map(kpi => `
                 <div class="kpi-card bg-white p-6 rounded-xl shadow-sm ${kpi.color}">
                    <div class="flex items-center">
                        <div class="p-3 bg-gray-100 rounded-full mr-4"><i class="${kpi.icon} text-xl text-gray-600"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">${kpi.label}</p>
                            <p class="text-3xl font-bold text-gray-800">${kpi.value}</p>
                        </div>
                    </div>
                </div>
            `).join('');


            // --- Update Charts ---
            const monthlyTrends = Array.from(new Map(yearData.map(d => [d.Date.getTime(), d])).values()).map(d => ({
                date: d.Date,
                revenue: d.Total_Revenue,
                spend: yearData.filter(i => i.Date.getTime() === d.Date.getTime()).reduce((sum, i) => sum + i.Spend, 0)
            })).sort((a,b) => a.date - b.date);

            const chartLabels = monthlyTrends.map(d => d.date);

            if (revSpendChart) revSpendChart.destroy();
            revSpendChart = new Chart(document.getElementById('revenueSpendChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [
                        {
                            label: 'Total Revenue',
                            data: monthlyTrends.map(d => d.revenue),
                            backgroundColor: 'rgba(75, 128, 222, 0.6)',
                            borderColor: 'rgba(75, 128, 222, 1)',
                            borderWidth: 1,
                            yAxisID: 'y',
                        },
                        {
                            label: 'Media Spend',
                            data: monthlyTrends.map(d => d.spend),
                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            type: 'line',
                            tension: 0.3,
                            yAxisID: 'y',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: `${selectedYear} Monthly Revenue vs. Spend`, font: { size: 18 } } },
                    scales: {
                        x: { type: 'time', time: { unit: 'month' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Amount (USD)' } }
                    }
                }
            });

            // Profitability Chart
            const monthlyProfitTrends = Array.from(new Map(yearData.map(d => [d.Date.getTime(), d])).values()).map(d => {
                const netRevenue = d.Total_Revenue - d.Total_Returns;
                const spend = yearData.filter(i => i.Date.getTime() === d.Date.getTime()).reduce((sum, i) => sum + i.Spend, 0);
                return {
                    date: d.Date,
                    netRevenue: netRevenue,
                    contributionMargin: netRevenue - spend,
                }
            }).sort((a,b) => a.date - b.date);

            if(profitabilityChart) profitabilityChart.destroy();
            profitabilityChart = new Chart(document.getElementById('profitabilityChart').getContext('2d'), {
                 type: 'bar',
                data: {
                    labels: monthlyProfitTrends.map(d=>d.date),
                    datasets: [
                         {
                            label: 'Net Revenue',
                            data: monthlyProfitTrends.map(d => d.netRevenue),
                            backgroundColor: 'rgba(67, 181, 129, 0.6)',
                            borderColor: 'rgba(67, 181, 129, 1)',
                            yAxisID: 'y',
                        },
                        {
                            label: 'Contribution Margin',
                            data: monthlyProfitTrends.map(d => d.contributionMargin),
                            type: 'line',
                            borderColor: 'rgba(250, 173, 20, 1)',
                            backgroundColor: 'rgba(250, 173, 20, 0.2)',
                            tension: 0.3,
                            yAxisID: 'y',
                        }
                    ]
                },
                options: {
                     responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: `${selectedYear} Monthly Profitability`, font: { size: 18 } } },
                    scales: {
                        x: { type: 'time', time: { unit: 'month' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Amount (USD)' } }
                    }
                }
            });
        }
        
        // --- Logic for Channel Efficiency Page (only runs once as it's for 2024) ---
        const year2024Data = masterData.filter(d => d.YEAR === 2024);
        const kpi2024 = Array.from(new Set(year2024Data.map(d => d.CHANNEL))).map(channel => {
            const channelData = year2024Data.filter(d => d.CHANNEL === channel);
            const spend = channelData.reduce((sum, d) => sum + d.Spend, 0);
            const customers = channelData.reduce((sum, d) => sum + d.Total_Customers, 0);
            const orders = channelData.reduce((sum, d) => sum + d.Total_Orders, 0);
            const sessions = channelData.reduce((sum, d) => sum + d.Sessions, 0);
            const clicks = channelData.reduce((sum, d) => sum + d.Clicks, 0);

            return {
                CHANNEL: channel,
                Spend: spend,
                Total_Customers: customers,
                Total_Orders: orders,
                Sessions: sessions,
                Clicks: clicks,
                CVR: sessions > 0 ? orders / sessions : 0,
                CAC: customers > 0 ? spend / customers : 0
            };
        });

        const chartableKPI = kpi2024.filter(d => d.Total_Customers > 0 && d.Spend > 0);

        if (efficiencyBubbleChart) efficiencyBubbleChart.destroy();
        efficiencyBubbleChart = new Chart(document.getElementById('efficiencyBubbleChart').getContext('2d'), {
            type: 'bubble',
            data: {
                datasets: chartableKPI.map(d => ({
                    label: d.CHANNEL,
                    data: [{ x: d.CAC, y: d.CVR, r: Math.sqrt(d.Total_Customers) / 5 }], // Scale radius for better viz
                    backgroundColor: `rgba(${Math.random()*255},${Math.random()*255},${Math.random()*255},0.7)`
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { title: { display: true, text: '2024 Channel Efficiency: CAC vs. CVR', font: { size: 18 } } },
                scales: {
                    y: { title: { display: true, text: 'Conversion Rate (CVR)' }, ticks: { callback: value => (value * 100).toFixed(2) + '%' } },
                    x: { title: { display: true, text: 'Customer Acquisition Cost (CAC)' }, ticks: { callback: value => '$' + value.toFixed(2) } }
                }
            }
        });

        // KPI Table
        const tableContainer = document.getElementById('kpi-table-container');
        let tableHTML = `
            <table class="w-full text-left">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-4 font-semibold">Channel</th>
                        <th class="p-4 font-semibold">CAC</th>
                        <th class="p-4 font-semibold">CVR</th>
                        <th class="p-4 font-semibold">Spend</th>
                        <th class="p-4 font-semibold">Total Customers</th>
                    </tr>
                </thead>
                <tbody>
        `;
        kpi2024.forEach(d => {
            tableHTML += `
                <tr class="border-b">
                    <td class="p-4 font-medium">${d.CHANNEL}</td>
                    <td class="p-4">${formatCurrency(d.CAC)}</td>
                    <td class="p-4">${(d.CVR * 100).toFixed(2)}%</td>
                    <td class="p-4">${formatCurrency(d.Spend)}</td>
                    <td class="p-4">${formatNumber(d.Total_Customers)}</td>
                </tr>
            `;
        });
        tableHTML += `</tbody></table>`;
        tableContainer.innerHTML = tableHTML;
        
        showPage('summary'); // Set initial page
        
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(`${pageId}-page`).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`a[onclick="showPage('${pageId}')"]`).classList.add('active');
            
            let title = "Executive Summary";
            let subtitle = "A high-level overview of business performance.";
            if(pageId === 'efficiency') {
                title = "Channel Efficiency";
                subtitle = "Identifying the most efficient marketing channels for 2024."
            } else if (pageId === 'profitability') {
                title = "Profitability Analysis";
                subtitle = "Analyzing core profitability metrics of the business."
            }
            pageTitle.innerText = title;
            pageSubtitle.innerText = subtitle;
        }

        yearSelector.addEventListener('change', updateDashboard);
        document.addEventListener('DOMContentLoaded', updateDashboard());
    </script>

</body>
</html>
